#!/bin/bash

set -eu

. .envrc

git_name=$(git log -1 --pretty=format:"%cn")
git_email=$(git log -1 --pretty=format:"%ce")

git clone \
  --depth 1 \
  --branch ${GHPAGES_BRANCH} \
  https://${PERSONAL_GITHUB_TOKEN}@github.com/${GITHUB_REPOSITORY} \
  public


hugo -t ${TEMPLATE}

cd public

git config user.name ${git_name}
git config user.email ${git_email}

git add .
git commit --allow-empty -m "Automated build at `date -Iseconds`"

git push
